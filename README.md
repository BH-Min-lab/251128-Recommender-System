# E-Commerce Recommender System

## Overview
ì´ì»¤ë¨¸ìŠ¤ ì‚¬ìš©ì í–‰ë™ ë°ì´í„° ê¸°ë°˜ ìƒí’ˆ ì¶”ì²œ ì‹œìŠ¤í…œì…ë‹ˆë‹¤. EDA ê¸°ë°˜ íœ´ë¦¬ìŠ¤í‹±ì—ì„œ ì‹œì‘í•˜ì—¬ XGBoost Learning to Rank ëª¨ë¸ê¹Œì§€ ë°œì „ì‹œì¼°ìŠµë‹ˆë‹¤.

**Final Score: NDCG@10 = 0.1455**

## Problem Definition

| í•­ëª© | ê°’ |
|------|-----|
| ëª©í‘œ | ê° ì‚¬ìš©ìì—ê²Œ êµ¬ë§¤ ê°€ëŠ¥ì„± ë†’ì€ ìƒìœ„ 10ê°œ ì•„ì´í…œ ì¶”ì²œ |
| í‰ê°€ ì§€í‘œ | NDCG@10 |
| ì´ ì´ë²¤íŠ¸ | 8,350,311ê±´ |
| ëŒ€ìƒ ì‚¬ìš©ì | 638,257ëª… |
| ì•„ì´í…œ | 29,502ê°œ |
| ë°ì´í„° ê¸°ê°„ | 2019-11-01 ~ 2020-02-29 (120ì¼) |

---

## EDA í•µì‹¬ ë°œê²¬

### ì¹´í…Œê³ ë¦¬ ë°ì´í„° ë¬¸ì œ ë°œê²¬ ë° í•´ê²°

EDA ê³¼ì •ì—ì„œ ì›ë³¸ ë°ì´í„°ì˜ `category_code` ì»¬ëŸ¼ì´ **ì‚¬ì‹¤ìƒ ë¬´ì˜ë¯¸**í•˜ë‹¤ëŠ” ê²ƒì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.

| ë¬¸ì œì  | ìƒì„¸ |
|--------|------|
| ë©”ì¸ ì¹´í…Œê³ ë¦¬ | **1ê°œ** (apparelë§Œ ì¡´ì¬) |
| ì„œë¸Œ ì¹´í…Œê³ ë¦¬ | 24ê°œ |
| NULL ë¹„ìœ¨ | ìƒë‹¹ìˆ˜ ê²°ì¸¡ê°’ ì¡´ì¬ |

ëª¨ë“  ë°ì´í„°ê°€ ë™ì¼í•œ "apparel" ì¹´í…Œê³ ë¦¬ë¡œ ë¶„ë¥˜ë˜ì–´ ìˆì–´, ì¹´í…Œê³ ë¦¬ ì •ë³´ë¥¼ í†µí•œ ìƒí’ˆ ì°¨ë³„í™”ê°€ ë¶ˆê°€ëŠ¥í–ˆìŠµë‹ˆë‹¤.

- ì‹¤ì œë¡œëŠ” ìƒ¤ì˜¤ë¯¸, ì‚¼ì„±, ì†Œë‹ˆ ë“± ì–´í˜ëŸ´ì´ ì•„ë‹Œ ë¸Œëœë“œë¥¼ í™•ì¸.

#### LLM ê¸°ë°˜ Real Category ìƒì„±

ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ **GPT-4o-minië¥¼ í™œìš©í•œ 2ë‹¨ê³„ ì¹´í…Œê³ ë¦¬ ì¬ë¶„ë¥˜** ì‘ì—…ì„ ìˆ˜í–‰í–ˆìŠµë‹ˆë‹¤.

**Step 1: ì¹´í…Œê³ ë¦¬ ì²´ê³„ ì œì•ˆ**
- ë¸Œëœë“œì™€ ê°€ê²© í†µê³„(í‰ê· , ì¤‘ì•™ê°’, ë²”ìœ„)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìƒ˜í”Œë§
- LLMì—ê²Œ 15-25ê°œì˜ ìƒí˜¸ ë°°íƒ€ì ì¸ ì¹´í…Œê³ ë¦¬ ì²´ê³„ ì œì•ˆ ìš”ì²­
- ê°€ê²©ëŒ€(price tier)ë¥¼ ê³ ë ¤í•œ ê³„ì¸µì  ì¹´í…Œê³ ë¦¬ ì„¤ê³„

**Step 2: ì „ì²´ ë¸Œëœë“œ ë¶„ë¥˜**
- ë°°ì¹˜ ì²˜ë¦¬(100ê°œì”©)ë¡œ ì „ì²´ ë¸Œëœë“œë¥¼ ì œì•ˆëœ ì¹´í…Œê³ ë¦¬ë¡œ ë¶„ë¥˜
- ë¸Œëœë“œëª…, í‰ê·  ê°€ê²©, ì•„ì´í…œ ìˆ˜, ìœ ì € ìˆ˜ë¥¼ ì»¨í…ìŠ¤íŠ¸ë¡œ ì œê³µ
- ê²°ê³¼ë¥¼ ìºì‹±í•˜ì—¬ ì¬ì‹¤í–‰ ì‹œ íš¨ìœ¨ì„± í™•ë³´

**ê²°ê³¼ë¬¼:**
- `new_train.parquet`: `real_category` ì»¬ëŸ¼ì´ ì¶”ê°€ëœ í•™ìŠµ ë°ì´í„°
- `category_schema.json`: LLMì´ ì œì•ˆí•œ ì¹´í…Œê³ ë¦¬ ì²´ê³„
- `brand_category_cache.json`: ë¸Œëœë“œë³„ ì¹´í…Œê³ ë¦¬ ë§¤í•‘ ìºì‹œ

ì´ë ‡ê²Œ ìƒì„±ëœ `real_category`ëŠ” Feature Engineeringì˜ `fine_category_match_score`ë¡œ í™œìš©ë˜ì–´ ëª¨ë¸ ì„±ëŠ¥ í–¥ìƒì— ê¸°ì—¬í–ˆìŠµë‹ˆë‹¤.

---

### ì´ë²¤íŠ¸ ë¶„í¬ ë° ì „í™˜ìœ¨
| Event Type | Count | ë¹„ìœ¨ |
|------------|-------|------|
| View | 8,331,873 | 99.78% |
| Cart | 16,362 | 0.20% |
| Purchase | 2,076 | 0.02% |

**ì „í™˜ìœ¨ ë¶„ì„:**
- View â†’ Cart: 0.20%
- Cart â†’ Purchase: **12.69%** (ì¥ë°”êµ¬ë‹ˆëŠ” ê°•ë ¥í•œ êµ¬ë§¤ ì‹ í˜¸)
- View â†’ Purchase: 0.02%

### ê°€ê²©ëŒ€ë³„ ì „í™˜ìœ¨
| Price Range | ì „í™˜ìœ¨ |
|-------------|--------|
| $0-50 (ì €ê°€) | 0.036% (ìµœê³ ) |
| $50-100 | 0.019% |
| $100-200 | 0.020% |
| $200-500 | 0.030% |
| $500+ (ê³ ê°€) | 0.012% (ìµœì €) |

### ì‹œê°„ íŒ¨í„´
| íŒ¨í„´ | íŠ¹ì§• |
|------|------|
| í”¼í¬ ìš”ì¼ | ëª©ìš”ì¼ (ì „í™˜ìœ¨ 7.2%ë¡œ ìµœê³ ) |
| í”¼í¬ ì‹œê°„ | 14-17ì‹œ |
| í™œì„± ì‹œê°„ | 10-18ì‹œ |
| ìµœì  ìœˆë„ìš° | ìµœê·¼ 40ì‹œê°„ ë‚´ Viewê°€ êµ¬ë§¤ì™€ ê°€ì¥ ë†’ì€ ìƒê´€ê´€ê³„ |

---

## Approach 1: Heuristic Recommender (v5)

EDAì—ì„œ ë°œê²¬í•œ íŒ¨í„´ì„ ê·œì¹™ ê¸°ë°˜ìœ¼ë¡œ êµ¬í˜„í•œ íœ´ë¦¬ìŠ¤í‹± ì¶”ì²œê¸°ì…ë‹ˆë‹¤.

### ì¶”ì²œ ìš°ì„ ìˆœìœ„
```
1. Cart ì•„ì´í…œ (ìµœìš°ì„ ) - êµ¬ë§¤ ì „í™˜ìœ¨ 12.69%
2. ë°˜ë³µ View ì•„ì´í…œ (2íšŒ+) - ê°•í•œ ê´€ì‹¬ ì‹ í˜¸
3. View ì•„ì´í…œ (ê°€ì¤‘ì¹˜ ì ìˆ˜ìˆœ)
4. ì¸ê¸° ì•„ì´í…œ (Fallback)
```

### ë‹¤ì°¨ì› ê°€ì¤‘ì¹˜ ì‹œìŠ¤í…œ
| Feature | ì¡°ê±´ | ê°€ì¤‘ì¹˜ |
|---------|------|--------|
| ê°€ê²© | $0-50 (ì €ê°€) | 1.5x |
| ê°€ê²© | $200-500 (ì¤‘ê³ ê°€) | 1.2x |
| ê°€ê²© | $500+ (ê³ ê°€) | 0.8x |
| ìš”ì¼ | ëª©ìš”ì¼ | 1.5x |
| ìš”ì¼ | ê¸ˆìš”ì¼ | 1.3x |
| ìš”ì¼ | í† ìš”ì¼ | 1.2x |
| ì‹œê°„ëŒ€ | 14-17ì‹œ (í”¼í¬) | 1.2x |
| ì‹œê°„ëŒ€ | 10-18ì‹œ (í™œì„±) | 1.1x |
| ë°˜ë³µ View | 2íšŒ | 1.5x |
| ë°˜ë³µ View | 3íšŒ | 2.0x |
| ë°˜ë³µ View | 5íšŒ+ | 3.0x |

ì´ íœ´ë¦¬ìŠ¤í‹± ì‹œìŠ¤í…œì˜ ê°€ì¤‘ì¹˜ë“¤ì´ ì´í›„ XGBoost ëª¨ë¸ì˜ Feature Engineering ê¸°ë°˜ì´ ë˜ì—ˆìŠµë‹ˆë‹¤.

---

## Approach 2: XGBoost Learning to Rank

íœ´ë¦¬ìŠ¤í‹±ì˜ í•œê³„(ìˆ˜ë™ ê°€ì¤‘ì¹˜ ì¡°ì •, ë¹„ì„ í˜• íŒ¨í„´ í•™ìŠµ ë¶ˆê°€)ë¥¼ ê·¹ë³µí•˜ê¸° ìœ„í•´ ML ëª¨ë¸ë¡œ ì „í™˜í–ˆìŠµë‹ˆë‹¤.

### System Architecture
```
Step 1: Candidate Generation
   â””â”€â”€ ìœ ì €ë‹¹ ìµœëŒ€ 600ê°œ í›„ë³´ ìƒì„±
       â”œâ”€â”€ Cart: 50ê°œ
       â”œâ”€â”€ Repeat View: 200ê°œ
       â”œâ”€â”€ Recent View: 200ê°œ
       â””â”€â”€ Popular: 200ê°œ

Step 2: Feature Extraction
   â””â”€â”€ 30ê°œ Feature ì¶”ì¶œ

Step 3: XGBoost Reranking
   â””â”€â”€ rank:ndcg ëª©ì í•¨ìˆ˜ë¡œ í•™ìŠµ

Step 4: Top-10 Selection
   â””â”€â”€ ìƒìœ„ 10ê°œ ìµœì¢… ì¶”ì²œ
```

### Model Configuration

| Parameter | Value |
|-----------|-------|
| Objective | rank:ndcg |
| Device | CUDA (RTX 3090) |
| learning_rate | 0.05 |
| n_estimators | 5000 |
| max_depth | 8 |
| min_child_weight | 50 |
| subsample | 0.8 |
| colsample_bytree | 0.8 |
| reg_alpha | 0.1 |
| reg_lambda | 1.0 |

### Feature Engineering (30 Features)

#### User-Item Interaction
| Feature | Description |
|---------|-------------|
| ui_view_cnt | ìœ ì €-ì•„ì´í…œ ì¡°íšŒ íšŸìˆ˜ |
| ui_view_cnt_40h | ìµœê·¼ 40ì‹œê°„ ë‚´ ì¡°íšŒ íšŸìˆ˜ |
| repeat2/3/5 | ì¬ì¡°íšŒ íŒ¨í„´ (2íšŒ/3íšŒ/5íšŒ ì´ìƒ) |
| ui_cart_flag | ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ ì—¬ë¶€ |
| ui_last_hours_ago | ë§ˆì§€ë§‰ ì¡°íšŒ í›„ ê²½ê³¼ ì‹œê°„ |

#### Temporal
| Feature | Description |
|---------|-------------|
| ui_last_dow | ë§ˆì§€ë§‰ ì¡°íšŒ ìš”ì¼ |
| ui_last_hour | ë§ˆì§€ë§‰ ì¡°íšŒ ì‹œê°„ëŒ€ |
| is_peak | í”¼í¬ ì‹œê°„ëŒ€ ì—¬ë¶€ (14-17ì‹œ) |
| is_active | í™œì„± ì‹œê°„ëŒ€ ì—¬ë¶€ (10-18ì‹œ) |
| is_thu/fri/sat | ìš”ì¼ í”Œë˜ê·¸ |

#### Item
| Feature | Description |
|---------|-------------|
| item_view_pop | ì•„ì´í…œ ì¡°íšŒ ì¸ê¸°ë„ |
| item_purchase_pop | ì•„ì´í…œ êµ¬ë§¤ ì¸ê¸°ë„ |
| item_purchase_rate | êµ¬ë§¤ ì „í™˜ìœ¨ |
| item_price | ì•„ì´í…œ ê°€ê²© |
| price_bucket | ê°€ê²© êµ¬ê°„ |
| price_bonus | ê°€ê²© ë³´ë„ˆìŠ¤ (EDA ê¸°ë°˜) |

#### Source & Score
| Feature | Description |
|---------|-------------|
| src_cart/repeat/recent/popular | í›„ë³´ ìƒì„± ì†ŒìŠ¤ |
| src_priority | ì†ŒìŠ¤ ìš°ì„ ìˆœìœ„ |
| v5_score | íœ´ë¦¬ìŠ¤í‹± ì ìˆ˜ (v5 ì‹œìŠ¤í…œ) |

#### Cluster (K-Means, k=50)
| Feature | Description |
|---------|-------------|
| item_cluster_id | ì•„ì´í…œ í´ëŸ¬ìŠ¤í„° ID |
| cluster_match_score | í´ëŸ¬ìŠ¤í„° ë§¤ì¹­ ì ìˆ˜ |
| fine_category_match_score | Fine category ë§¤ì¹­ ì ìˆ˜ |

### Feature Importance (Top 10)

| Rank | Feature | Importance (Gain) |
|------|---------|-------------------|
| 1 | src_popular | 874.89 |
| 2 | src_priority | 118.77 |
| 3 | v5_score | 81.03 |
| 4 | ui_last_hours_ago | 45.28 |
| 5 | item_purchase_pop | 22.64 |
| 6 | src_recent | 15.72 |
| 7 | repeat2 | 15.46 |
| 8 | ui_view_cnt | 14.57 |
| 9 | repeat3 | 12.07 |
| 10 | ui_view_cnt_40h | 5.79 |

**Key Insight:** íœ´ë¦¬ìŠ¤í‹± ì ìˆ˜(v5_score)ê°€ 3ìœ„ë¡œ, EDA ê¸°ë°˜ ê·œì¹™ì´ MLì—ì„œë„ ìœ íš¨í•¨ì„ ì¦ëª…

---

## Training Statistics

| Metric | Value |
|--------|-------|
| Train users | 47,825 |
| Validation users | 12,175 |
| Train samples | 28,694,890 |
| Train positives | 8,881 (0.03%) |
| Best iteration | 115 |

## Output Statistics

| Metric | Value |
|--------|-------|
| Total recommendations | 6,382,570 |
| Users | 638,257 |
| Unique items recommended | 26,061 |
| Cold users | 817 (0.1%) |
| Avg recs per user | 10.0 |

## Execution Time

| Phase | Time |
|-------|------|
| ì „ì²´ ì‹¤í–‰ | ì•½ 41ë¶„ |
| XGBoost í•™ìŠµ | ì•½ 1ë¶„ 15ì´ˆ |
| ì¶”ë¡  | ì•½ 20ë¶„ |

---

## Key Takeaways

1. **EDAê°€ MLì˜ ê¸°ë°˜** - ê°€ê²©/ìš”ì¼/ì‹œê°„ëŒ€ íŒ¨í„´ì´ Featureë¡œ ì§ì ‘ ë³€í™˜ë˜ì–´ ëª¨ë¸ ì„±ëŠ¥ì— ê¸°ì—¬

2. **íœ´ë¦¬ìŠ¤í‹± â†’ ML ì ì§„ì  ë°œì „** - v5 íœ´ë¦¬ìŠ¤í‹±ì˜ ê°€ì¤‘ì¹˜ ì‹œìŠ¤í…œì´ Feature Importance ìƒìœ„ê¶Œ (v5_score 3ìœ„)

3. **Candidate Generationì´ í•µì‹¬** - src_popularê°€ 874.89ë¡œ ì••ë„ì  1ìœ„, ì¢‹ì€ í›„ë³´ ì§‘í•©ì´ ì •êµí•œ ë¦¬ë­í‚¹ë³´ë‹¤ ì¤‘ìš”

4. **GPU ê°€ì†ì˜ íš¨ìœ¨ì„±** - RTX 3090ìœ¼ë¡œ 2,900ë§Œ ìƒ˜í”Œ í•™ìŠµì´ 1ë¶„ 15ì´ˆ ë§Œì— ì™„ë£Œ

---

## Environment

- Python 3.x
- XGBoost with CUDA support
- RTX 3090 GPU (24GB VRAM)
- pandas, numpy, scikit-learn

---

## Result

### ğŸ† Leader Board

- **ìˆœìœ„**:ğŸ¥‡ **1ìœ„**
- **NDCG@10**: 0.1458

![leaderboard_capture](./images/2025-12-19%20191527.png)